<!DOCTYPE html>
<html lang='en'>
<head>

	<title>Tuvida</title>
	<meta charset='utf-8'/>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<style> @import url(style.css); </style>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.17/index.global.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.17/index.global.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.17/index.global.min.js'></script>

</head>
<body onload="renderCalendar()">

	<div class="container">
	
		<div class="row">
			<div class="col-6"> <h1><b><span id="view-name">Vista de mes</span></b></h1> </div>
			<div class="col-6"> <div id="view_select"></div> </div>
		</div>
		
		<div id='calendar'></div>
		
	</div>

</body>
<script>
	
	if (getViewName()==null)	{setViewName('dayGridMonth')} 
	
	function getViewName()		{return localStorage.getItem('view-name');}
	function setViewName(view)	{localStorage.setItem('view-name', view);}
	
	let views_array = [
		['dayGridMonth', 'Vista de mes'],
		['dayGridWeek', 'Vista de semana'],
		['dayGridDay', 'Vista de d√≠a'],
	];



	/*** Renders the main calendar page. ***/
	function renderCalendar() {
		//Renders the calendar block.
		var calendarEl = document.getElementById('calendar');
		var calendarDiv = new FullCalendar.Calendar(calendarEl, {
			initialView: getViewName()
		});
		calendarDiv.render();
	
		//Renders the calendar view selection if it's empty.
		var options = document.getElementById('view_select');
		if (options.innerHTML === "") {
			renderViewSelection();
		}
		
		//Activates and disables the buttons accordingly.
		for (let i=0; i<views_array.length; i++) {
			let button = document.querySelector('#'+views_array[i][0]+'');
			if (getViewName() == views_array[i][0]) {
				button.setAttribute('disabled', true);
			} else {
				button.removeAttribute('disabled');
			}
		}
	}
	
	
	/*** Renders the different options for viewing the calendar. ***/
	function renderViewSelection() {
		var options = document.getElementById('view_select');
		
		var optionsRow = document.createElement('div');
		optionsRow.classList.add('row');
		
		for (let i=0; i<views_array.length; i++) {
			let optionCol = document.createElement('div');
			optionCol.classList.add('col-3');
			
			let optionButton = document.createElement('button');
			optionButton.innerText = views_array[i][1];
			optionButton.setAttribute("id", views_array[i][0]);
			optionButton.addEventListener( 'click', function() { 
				changeCalendarView(views_array[i][0], views_array[i][1])
			});
			
			optionCol.appendChild(optionButton);
			optionsRow.appendChild(optionCol);
		}
		options.appendChild(optionsRow);
	}
	
	
	/*** Changes the calendar view and reloads it. ***/
	function changeCalendarView(viewName, viewTitle) {
		document.getElementById('view-name').textContent = viewTitle;
		setViewName(viewName);
		renderCalendar();
	}


</script>
</html>