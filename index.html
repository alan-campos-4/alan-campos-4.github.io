<!DOCTYPE html>
<html lang='en'>
<head>

	<title>Tuvida</title>
	<meta charset='utf-8'/>
	
	<!--Bootstrap CDN-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
		rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
		crossorigin="anonymous" />
	
	<!--FullCalendar local files-->
	<link href='dist/codepen.css' rel='stylesheet' />
	<script src='dist/index.global.js'></script>
	<script src='dist/codepen.js'></script>
	
	<!--JQuery-->
	<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
	<script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">
	<link rel="stylesheet" href="/resources/demos/style.css">
	<script>
		$( function() {
			$("#datepickerStart1").datepicker({
				dateFormat: 'dd/mm/yy'
			});
			$("#datepickerStart2").datepicker({
				dateFormat: 'dd/mm/yy'
			});
			$("#datepickerEnd1").datepicker({
				dateFormat: 'dd/mm/yy'
			});
			$("#datepickerEnd2").datepicker({
				dateFormat: 'dd/mm/yy'
			});
		});
	</script>

</head>
<style>

	body {
		margin: 40px 10px;
		padding: 0;
		font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
		font-size: 14px;
	}

	#calendar {
		max-width: 1100px;
		margin: 0 auto;
	}

</style>
<body>

	<div class="container">
		
		<h3>Crear evento</h3>
		<div class="row">
			<div class="col-9">
				Name	<input type="text" id="eventName1">
			</div>
		</div>
		<div class="row">
			<div class="col-3">
				Start	<input type="text" id="datepickerStart1">
			</div>
			<div class="col-6">
				Time	<input type="text" id="">
			</div>
		</div>
		<div class="row">
			<div class="col-3">
				End		<input type="text" id="datepickerEnd1">
			</div>
			<div class="col-6">
				Time	<input type="text" id="">
			</div>
		</div>
		<button onclick="addEvent()">Crear</button>
		<br><br>
		
		<h3>Modificar evento</h3>
		<div class="row">
			<div class="col-9">
				Name	<input type="text" id="eventName2">
			</div>
		</div>
		<div class="row">
			<div class="col-3">
				Start	<input type="text" id="datepickerStart2">
			</div>
			<div class="col-6">
				Time	<input type="text" id="timeStart2">
			</div>
		</div>
		<div class="row">
			<div class="col-3">
				End		<input type="text" id="datepickerEnd2">
			</div>
			<div class="col-6">
				Time	<input type="text" id="timeEnd2">
			</div>
		</div>
		<button onclick="modifyEvent()">Modificar</button>
		
	</div>
	
	<hr>
	<br><br><br>

	<div id='calendar-container'>
		<div id='calendar'></div>
	</div>
	
	<!-- Button trigger modal -->
	<!--<button type="button" class="btn btn-primary" data-bs-toggle="modal" onclick="openModal()">
		Crear evento
	</button>-->
	
	<!-- Add Event Modal -->
	<!--div class="modal fade" id="demo" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="staticBackdropLabel"> Crear evento </h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
				</div>
				<div class="modal-body">
					Nombre <input type="text" name="event_name"><br>
					Fecha <input type="text" id="datepicker">
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
					<button type="button" class="btn btn-primary" onclick="createEvent()">Crear</button>
				</div>
			</div>
		</div>
	</div>-->



</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
	integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" 
	crossorigin="anonymous">
</script>
<script>

	var calendar;
	
	
	document.addEventListener('DOMContentLoaded', function() {
		var calendarDiv = document.getElementById('calendar');
		calendar = new FullCalendar.Calendar(calendarDiv, {
			themeSystem: 'bootstrap5',
			height: 'auto',
			slotMinTime: '08:00',
			slotMaxTime: '20:00',
			headerToolbar: {
				left: 'prev,next today',
				center: 'title',
				right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
			},
			views: {
				dayGridMonth: { buttonText: 'Month' },
				timeGridWeek: { buttonText: 'Week' },
				timeGridDay: { buttonText: 'Day' },
				listMonth: { buttonText: 'List Month' },
				timeGrid: { dayMaxEventRows: 6 },
			},
			navLinks: true, // can click day/week names to navigate views
			editable: true,
			selectable: true,
			nowIndicator: true,
			dayMaxEventRows: true,
			events: [
				{
				title: 'All Day Event',
				start: '2025-05-01',
				},
				{
				title: 'Long Event',
				start: '2025-01-07',
				end: '2025-05-10'
				},
				{
				groupId: 999,
				title: 'Repeating Event',
				start: '2025-05-09T16:00:00'
				},
				{
				groupId: 999,
				title: 'Repeating Event',
				start: '2025-05-16T16:00:00'
				},
				{
				title: 'Conference',
				start: '2023-05-11',
				end: '2025-05-13'
				},
				{
				title: 'Meeting',
				start: '2023-05-12T10:30:00',
				end: '2025-05-12T12:30:00'
				},
				{
				title: 'Lunch',
				start: '2025-05-12T12:00:00'
				},
				{
				title: 'Dinner',
				start: '2025-05-12T20:00:00'
				},
				{
				title: 'Birthday Party',
				start: '2025-05-13T07:00:00'
				},
				{
				title: 'Click for Google',
				url: 'http://google.com/',
				start: '2025-05-28'
				}
			],
			eventClick: function(info) {eventOnClick(info)},
		});
		calendar.render();
		
		setEventID(null);
	});
	
	
	
	/*** LocalStorage functions ***/
	
	function getEventID()		{return localStorage.getItem('event-id-to-modify');}
	function setEventID(newID)	{localStorage.setItem('event-id-to-modify', newID);}
	
	
	
	/*** Modal pop-up ***/
	
	function openModal() {
		var myModal = new bootstrap.Modal(document.getElementById('demo'), {})
		myModal.toggle()
	};
	
	
	
	/***  Adding Calendar Events ***/
	
	function addEvent() {
		var name = document.getElementById("eventName1").value;
		var startDate = $("#datepickerStart1").datepicker("getDate");
		var endDate = $("#datepickerEnd1").datepicker("getDate");
		
		if ( !isNaN(startDate.valueOf()) || !isNaN(endDate.valueOf()) ) {
			calendar.addEvent({
				title: name,
				start: startDate,
				end: endDate,
				allDay: true
			});
			console.log('Event created.\n Name: ' + name + '\n Start: ' + startDate + '\n End: ' + endDate);
		} else {
			console.log('Event not created.');
		}
	};
	
	
	
	/***  Modifying Calendar Events ***/
	
	function eventOnClick(info) {
		// Display event name in input.
		document.getElementById("eventName2").value = info.event.title;
		
		// Display the dates of the event's start and end in the datepickers.
		var startDate = $.datepicker.formatDate("dd/mm/yy", info.event.start);
		var endDate = $.datepicker.formatDate("dd/mm/yy", info.event.end);
		$("#datepickerStart2").datepicker("setDate", startDate);
		$("#datepickerEnd2").datepicker("setDate", endDate);
		
		// Display the time of the event's start and end in the input.
		document.getElementById('timeStart2').value =	toDoubleDigits(info.event.start.getHours()) +':'+ toDoubleDigits(info.event.start.getMinutes());
		if (info.event.end!=null) {
			document.getElementById('timeEnd2').value =	toDoubleDigits(info.event.end.getHours()) +':'+ toDoubleDigits(info.event.end.getMinutes());
		} else {
			document.getElementById('timeEnd2').value =	'';
		}
		
		// Log the event and save in localStorage for modifying later.
		console.log('Event selected.\n Name: ' + info.event.title + '\n Start: ' + startDate + '\n End: ' + endDate);
		setEventID(info.event.id);
	}
	
	function toDoubleDigits(num) {
		if (num<10) return ('0'+num);
		else return num;
	}
	
	function modifyEvent() {
		var event_id = getEventID();
		if (event_id!=null) {
			var event = calendar.getEventById(event_id);
			if (event!=null) {
				
				var name = document.getElementById("eventName2").value;
				var start = $("#datepickerStart2").datepicker("getDate");
				var end =   $("#datepickerEnd2").datepicker("getDate");
				
				let startTime = document.getElementById('timeStart2').value.split(':');
				let startHour = startTime[0];
				let startMin = startTime[1];
				let newStart = new Date(start.getFullYear(), start.getMonth(), start.getDate(), startHour, startMin);
				event.setStart(newStart);
				console.log('Event '+name+' changed start to:\n '+newStart);
				
				if (end!=null) {
					let endTime = document.getElementById('timeEnd2').value.split(':');
					let endHour = endTime[0];
					let endMin = endTime[1];
					let newEnd = new Date(end.getFullYear(), end.getMonth(), end.getDate(), endHour, endMin);
					event.setEnd(newEnd);
					console.log('Event '+name+' changed end to:\n '+newEnd);
				}
			} else {
				console.log('Event is null');
			}
		} else {
			console.log('Event id not found');
		}
	}
	
	
	
	
	

</script>
</html>